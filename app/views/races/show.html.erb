<div class='col-sm-12'>
  <div class='col-md-6'>
    <table class='table table-striped table-bordered table-compacted' >
      <tr>
        <th>Nom</th>
        <td><%= @race.name%></td>
      </tr>
      <tr>
        <th>Date</th>
        <td><%= I18n.l @race.date unless @race.date.nil?%></td>
      </tr>
      <tr>
        <th>Email Sender</th>
        <td><%= @race.email_sender%></td>
      </tr>
      <tr>
        <th>Email Name</th>
        <td><%= @race.email_name%></td>
      </tr>
      <tr>
        <th>Fichier</th>
        <td class='text-center'>
          <%= link_to "Télécharger le fichier CSV", @race.raw_results.url, class: 'btn btn-default'%>
        </td>
      </tr>
      <tr>
        <th>Template</th>
        <td><%=@race.template%></td>
      </tr>
      <tr>
        <th>Nombre de coureurs</th>
        <td><%=@race.runners_count%></td>
      </tr>
      <tr>
        <th>Courses</th>
        <td><%=@race.races_count%> Courses<br>
        <%@race.races.each do |race|%>
          <span class="label label-primary"><%=race%></span>
        <%end%>
        </td>
      </tr>
      <% unless @race.results.empty?
        runner = @race.results.order("RANDOM()").limit(1).first
      %>
      <tr>
        <th>Message</th>
        <td>
          <%= runner.sent_message%>
        </td>
      </tr>
      <%end%>

    </table>
  </div>
  <div class='col-md-6'>
    <%=image_tag @race.background_image.url(:medium), class:'pull-right' %>
  </div>
</div>

<div class='col-sm-12'>
  <%= link_to "Editer", edit_race_path(@race), class: 'btn btn-default' %>
  <%= link_to "Retour à la Liste", races_path, class: 'btn btn-default' %>
  <div class='pull-right'>
    <%= link_to "Supprimer", race_path(@race), class: "btn btn-danger", "data-confirm" => "Etes-vous sûr ?", "data-method" => :delete -%>
    <%= link_to "Envoyer", send_results_race_path(@race), class: "btn btn-warning", "data-confirm" => "Etes-vous sûr ?", "data-method" => :post -%>
  </div>
</div>

<div class='col-sm-12 top-buffer'>
  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#results" aria-controls="results" role="tab" data-toggle="tab">Résultats</a></li>
    <li role="presentation"><a href="#stats" aria-controls="stats" role="tab" data-toggle="tab">Statistiques</a></li>
    <li role="presentation"><a href="#widget" aria-controls="widget" role="tab" data-toggle="tab">Widget</a></li>
  </ul>

    <!-- Tab panes -->
  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="results">
      <%= render partial: "results"%>
    </div>
    <div role="tabpanel" class="tab-pane" id="stats">
      <%= render partial: 'statistics'%>
    </div>
    <div role="tabpanel" class="tab-pane" id="widget">
      <div class='col-sm-12'>
        <h4>Code pour afficher le widget</h4>
        <textarea class='form-control' rows=5><%=@race.widget_gist%></textarea>
      </div>
      <div class='col-sm-12 top-buffer text-center'>
        <%= link_to "Générer le widget", generate_widget_race_path(@race), class: "btn btn-primary", "data-method" => :post -%>
        <%= link_to "Afficher le widget", @race.widget_url, class: "btn btn-primary", target: "_widget" -%>
      </div>
      <div class='col-sm-12 top-buffer'>
        <h4>Widget </h4>
        <%=@race.widget_gist.html_safe%>
      </div>
    </div>
  </div>
</div>

